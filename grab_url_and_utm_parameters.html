<script type="text/javascript">
window.onload = (event) => {
    // Parse the URL path
    function getCookie(name){
        var re = new RegExp(name + "=([^;]+)");
        var value = re.exec(document.cookie);
        return (value != null) ? unescape(value[1]) : null;
      }
    // Parse the URL for UTM
    function getParameterByName(name, url) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function retreiveUTM(){
        var url = getCookie('__gtm_url_with_params');
        var source = getParameterByName('utm_source', url);
        var medium = getParameterByName('utm_medium', url);
        var campaign = getParameterByName('utm_campaign', url);
        var content = getParameterByName('utm_content', url);
        var term = getParameterByName('utm_term', url);
        var gclid = getParameterByName('gclid', url);

        if (jQuery('[data-mapping="utm_source"]')) {
            jQuery('[data-mapping="utm_source"]').val(source);
        } 
        if (jQuery('[data-mapping="utm_campaign"]')) {
            jQuery('[data-mapping="utm_campaign"]').val(campaign);
        }
        if (jQuery('[data-mapping="utm_medium"]')) {
            jQuery('[data-mapping="utm_medium"]').val(medium);
        }
        if (jQuery('[data-mapping="utm_content"]')) {
            jQuery('[data-mapping="utm_content"]').val(content);
        }
        if (jQuery('[data-mapping="utm_term"]')) {
            jQuery('[data-mapping="utm_term"]').val(term);
        }
        if (jQuery('[data-mapping="GCLID"]')) {
            jQuery('[data-mapping="GCLID"]').val(gclid);
        }
    }
    window.addEventListener('uberflip.ctaActivate', (ctaId) => {
        retreiveUTM();  
    });
}

</script>
